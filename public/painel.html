<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="shortcut icon" href="assets/logo/logo-footer.png" type="image/x-icon">
    <title>Specula | Painel</title>
    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>

    <!-- Montserrat Font -->
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/dash.css">

    <!-- chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- icons -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css" />
</head>

<body>
    <div class="grid-container">
        <!-- Header -->
        <header class="header">
            
            

            <div class="user">
                <span id="user">Olá, usuário!</span>
            </div>

            <div class="search-box">
                <input type="text" class="search-txt" placeholder="Buscar Máquina">
                <a href="#" class="search-btn">
                    <img src="assets/icons/icons8-pesquisar.svg" height="20" width="20">
                </a>
            </div>
        </header>
        <!-- End Header -->

        <!-- Sidebar -->
        <aside id="sidebar">
            <div class="sidebar-title">
                <div class="sidebar-brand">
                    <img src="assets/logo/logo.svg" alt="">
                </div>
                <span class="material-icons-outlined" onclick="closeSidebar()">close</span>
            </div>

            <ul class="sidebar-list">
                <a href="dashV3.html">
                    <li class="sidebar-list-item">
                        <i class="uil uil-chart-line"></i> Dashboard
                    </li>
                </a>
                <a href="#">
                    <li class="sidebar-list-item">
                        <i class="uil uil-graph-bar"></i> Painel
                    </li>
                </a>


                <a href="crudMaquina.html">
                    <li class="sidebar-list-item">
                        <i class="uil uil-monitor"></i>Cadastrar máquina
                    </li>
                </a>
                <a href="download.html">
                    <li class="sidebar-list-item">
                        <i class="uil uil-arrow-to-bottom"></i>Download
                    </li>
                </a>
                <a href="index.html">
                    <li class="sidebar-list-item">
                        <i class="uil uil-signout"></i>Sair
                    </li>
                </a>
            </ul>
        </aside>
        <!-- End Sidebar -->

        <main class="main-container" style="background-color: red;">
            <div class="charts" id="container_painel_id" style="background-color: blue;">
                <div class="container-dash">
                    <div id="maquina1" class="maquinas">
                        <div class="titulo-dash-maquina">
                            <div class="desligar">
                                <img src="assets/icons/Group 156.png">
                            </div>
                            <h2></h2>
                            <img src="assets/icons/Icon-color.png" alt="">
                        </div>
                        <div class="dashs-maquinas-cads">
                            <canvas id="myChartDinamic"></canvas>
                        </div>
                    </div>
                </div>

            <div class="dashboards" id="dashboards_id" >
                <div class="painel-dashboards" style="display: none;">
                    <div class="title-painel-dash">
                        <div class="titletext">
                            <h1>BBD012274</h1><i class='bx bx-x-circle'></i>
                        </div>
                    </div>
                    <div class="container-painel-dashs">
                        <div class="container-cpu">
                            <div class="container-cpu-left">
                                <div class="titulo-cpu">
                                </div>
                                <div class="cad-hard-info">
                                    <div class="hard-info-cpu">
                                        <h2>CPU</h2>
                                        <h3>Nome: <span>AMD Ryzen 5 5500U</span></h3>
                                        <h3>Pacotes Físicos: <span>1</span></h3>
                                        <h3>CPUs Físicas: <span>6</span></h3>
                                        <h3>CPUs Lógicas: <span>12 </span></h3>
                                        <h3>Frequência: <span>4056000 </span></h3>
                                        <h3>Fabricante: <span>Authentic AMD </span></h3>
                                    </div>
                                    <div class="destaque-info-cpu">
                                        <div class="circle_destaque">
                                            <h1>56%</h1>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="dash-container-cpu">
                                <canvas id="myChartcpu"></canvas>
                            </div>
                        </div>
                        <div class="container-memoria">
                            <div class="container-memoria-left">
                                <div class="titulo-memoria">
                                </div>
                                <div class="cad-hard-info-memoria">
                                    <div class="hard-info-memoria">
                                        <h2>Memoria</h2>

                                        <h3>Em uso: <span>4,3</span></h3>
                                        <h3>Disponível: <span>1,3</span></h3>
                                        <h3>Total <span>5,7</span></h3>
                                    </div>
                                    <div class="destaque-info-memoria">
                                        <div class="circle_destaque-memoria">
                                            <h1>78%</h1>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="dash-container-memoria">
                                <canvas id="myChartmemoria"></canvas>
                            </div>
                        </div>
                        <div class="container-disco">
                            <div class="container-disco-left">
                                <div class="titulo-disco">
                                </div>
                                <div class="cad-hard-info">
                                    <div class="hard-info-disco">
                                        <h2>Disco</h2>
                                        <h3>Tamho: <span>256</span></h3>
                                        <h3>Leitura: <span>11</span></h3>
                                        <h3>Bytes de leitura: <span>22</span></h3>
                                        <h3>Escritas: <span>29</span></h3>
                                        <h3>Bytes de escrita: <span>62</span></h3>
                                        <h3>Tamanho atual da fila: <span>0</span></h3>
                                        <h3>Tempo de transferência: <span>10</span></h3>
                                    </div>
                                    <div class="destaque-info-disco">
                                        <div class="circle_destaque-disco">
                                            <h1>0</h1>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="dash-container-disco">
                                <canvas id="myChartdisco"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>

        </main>

    </div>
</body>





<script>

    function sairPage() {

        sessionStorage.clear()

        window.location = "index.html"

    }

    function verificarCargo() {

        if (sessionStorage.getItem("CARGO_USUARIO") == "Admin") {

            console.log("Is admin")


        } else {

            icon4.style.display = "none"
            linkIcon4.style.display = "none"
            LIIncon4.style.display = "none"

        }

    }


</script>
<script>
    
    let allscreen = document.querySelector(".grid-container")
    var tela_dashs = document.getElementById("dashboards_id");
var painel_maquinas = document.getElementById("container_painel_id");
    let dashboard_selected = document.querySelector(".maquinas");
    let painel_dash = document.querySelector(".painel-dashboards")

    function alterarDispoDaTela(selected){
    if(selected == 0){
        painel_maquinas.style.display = "flex";
        titulo_pagina_id.innerHTML = "";
        titulo_pagina_id.innerHTML = "Painel de máquinas";
        icon1.style.color = "red"
        icon2.style.color = "white"
        tela_dashs.style.display = "none"
        
    }
    if(selected == 1){
        painel_maquinas.style.display = "none";
        titulo_pagina_id.innerHTML = "";
        titulo_pagina_id.innerHTML = "Dashboards";
        icon1.style.color = "white"
        icon2.style.color = "red"
        tela_dashs.style.display = "flex"
    }
}


    dashboard_selected.onclick = function(){

        let container_dash_let = document.querySelector(".container-dash")
        let header_let = document.querySelector(".header");
        painel_dash.style.zIndex = "1000";
        painel_dash.style.display = "block";
        painel_dash.style.position = "fixed";      
        allscreen.style.overflow = "hidden";
        container_dash_let.style.filter = "blur(15px)";
        header_let.style.filter = "blur(15px)";
        container_dash_let.style.pointerEvents = "none";
       

    }

    let btn_fechar_modal = document.querySelector(".bx-x-circle");

    btn_fechar_modal.onclick = function(){
        let container_dash_let = document.querySelector(".container-dash");
        let header_let = document.querySelector(".header");

        painel_dash.style.position = "none";
        allscreen.style.overflow = "auto";
        painel_dash.style.display = "none";
        painel_dash.style.zIndex = "-1000";
        header_let.style.filter = "blur(calc(15px - 15px))";
        container_dash_let.style.filter = "blur(calc(15px - 15px))"
        container_dash_let.style.pointerEvents = "all";

    }

</script>


</html>

<!-- // Função de fechar modal tem que dar um clearTimeout  clearTimeout(proximaAtualizacao); -->

<script>
    var proximaAtualizacao;



    function obterDadosGraficoProcessador() {
        if (proximaAtualizacao != undefined) {
            clearTimeout(proximaAtualizacao);
        }
        var idEmpresa = sessionStorage.FK_EMPRESA;


        fetch(`/medidas/ultimas/${idEmpresa}`, { cache: "no-store" })
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        resposta.reverse();

                        plotarGraficoProcessador(resposta, idEmpresa);
                    });
                } else {
                    console.error("Nenhum dado encontrado ou erro na API");
                }
            })
            .catch(function (error) {
                console.error(
                    `Erro na obtenção dos dados p/ gráfico: ${error.message}`
                );
            });
    }

    function plotarGraficoProcessador(resposta, idEmpresa) {
        console.log("iniciando plotagem do gráfico...");

        var dados = {
            labels: [],
            datasets: [
                {
                    label: "Processador em uso",
                    borderColor: "#E0AA1E",
                    backgroundColor: "#E0AA1E",
                    fill: true,
                    data: [],
                }
            ],
        };

        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            dados.labels.push(registro.data_hora_registro)
            dados.datasets[0].data.push(Number(registro.processador_em_uso).toFixed(0));
        }

        const config = {
            type: 'line',
            data: dados,
        };

        let myChart = new Chart(
            document.getElementById('myChartDinamic'),
            config
        );

        setTimeout(() => atualizarGraficoProcessador(idEmpresa, dados, myChart), 2000);
    }



    function atualizarGraficoProcessador(idEmpresa, dados, myChart) {
        fetch(`/medidas/tempo-realTemperatura/${idEmpresa}`, { cache: "no-store" })
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (novoRegistro) {
                        console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
                        console.log(`Dados atuais do gráfico: ${dados}`);

                        // tirando e colocando valores no gráfico
                        dados.labels.shift(); // apagar o primeiro
                        dados.labels.push(novoRegistro[0].data_hora_registro); // incluir um novo momento

                        dados.datasets[0].data.shift(); // apagar o primeiro de temperatura
                        dados.datasets[0].data.push(Number(novoRegistro[0].processador_em_uso).toFixed(0)); // incluir uma nova medida de temperatura

                        myChart.update();

                        // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                        proximaAtualizacao = setTimeout(
                            () => atualizarGraficoProcessador(idEmpresa, dados, myChart),
                            2000
                        );
                    });
                } else {
                    console.error("Nenhum dado encontrado ou erro na API");
                    // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                    proximaAtualizacao = setTimeout(
                        () => atualizarGraficoProcessador(idEmpresa, dados, mychart),
                        2000
                    );
                }
            })
            .catch(function (error) {
                console.error(`
          Erro na obtenção dos dados p/ gráfico: ${error.message}
        `);
            });
    }

    obterDadosGraficoProcessador();
    verifyMachines();

</script>

